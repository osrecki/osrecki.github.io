<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>ADT serialisation with Play JSON | Kodin.me</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="ADT serialisation with Play JSON" />
<meta name="author" content="Dinko Osrecki" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Algebraic data type is a type formed by combining product types and sum types. Product type combines multiple values of different types into one. It is called “tuple”, “record”, “struct”, “class”. Sum type represents a value that is either of one type or another. It is called “variant”, “enumeration”, “tagged union”." />
<meta property="og:description" content="Algebraic data type is a type formed by combining product types and sum types. Product type combines multiple values of different types into one. It is called “tuple”, “record”, “struct”, “class”. Sum type represents a value that is either of one type or another. It is called “variant”, “enumeration”, “tagged union”." />
<link rel="canonical" href="https://kodin.me/2019/08/24/adt-serialisation-with-play-json.html" />
<meta property="og:url" content="https://kodin.me/2019/08/24/adt-serialisation-with-play-json.html" />
<meta property="og:site_name" content="Kodin.me" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-24T11:00:00+02:00" />
<script type="application/ld+json">
{"description":"Algebraic data type is a type formed by combining product types and sum types. Product type combines multiple values of different types into one. It is called “tuple”, “record”, “struct”, “class”. Sum type represents a value that is either of one type or another. It is called “variant”, “enumeration”, “tagged union”.","@type":"BlogPosting","headline":"ADT serialisation with Play JSON","url":"https://kodin.me/2019/08/24/adt-serialisation-with-play-json.html","dateModified":"2019-08-24T11:00:00+02:00","datePublished":"2019-08-24T11:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kodin.me/2019/08/24/adt-serialisation-with-play-json.html"},"author":{"@type":"Person","name":"Dinko Osrecki"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="/favicon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" integrity="sha256-xXvhARLH+UPwzIo4QbkSAEJjhxzLlz9Zt9uzy7RDxQE=" crossorigin="anonymous" href="/assets/vendor-c57be10112c7f943f0cc8a3841b912004263871ccb973f59b7dbb3cbb443c501.css">
    <link rel="stylesheet" type="text/css" integrity="sha256-nQCfrhA22XpyRPv2lqucNQQ/uyp63P8B4HkaZOqDQfc=" crossorigin="anonymous" href="/assets/kodin-9d009fae1036d97a7244fbf696ab9c35043fbb2a7adcff01e0791a64ea8341f7.css"><link type="application/atom+xml" rel="alternate" href="https://kodin.me/feed.xml" title="Kodin.me" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-146428250-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-146428250-1');
    </script><script defer integrity="sha256-zkXZQ83aIDdTFIh6ZGeK+D1dNeoyEA6wVQ6nbI9PFAw=" crossorigin="anonymous" src="/assets/hamburger-ce45d943cdda20375314887a64678af83d5d35ea32100eb0550ea76c8f4f140c.js" type="text/javascript"></script>
    <script integrity="sha256-YQUgZyojM73bJamueVRdtZVN8BIgReoXUZ+u5oCn4UI=" crossorigin="anonymous" src="/assets/svg.min-610520672a2333bddb25a9ae79545db5954df0122045ea17519faee680a7e142.js" type="text/javascript"></script>
    <script integrity="sha256-JVtklRX+zS99MFAQnuAecYuFB+zz11WOFNdNx5qkyqM=" crossorigin="anonymous" src="/assets/rx.lite.min-255b649515fecd2f7d3050109ee01e718b8507ecf3d7558e14d74dc79aa4caa3.js" type="text/javascript"></script>
</head>
<body><header class="ray-page-container ray-page-container--justify-center kodin-header">
    <div class="ray-grid">
        <div class="ray-grid__cell ray-grid__cell--span-4-desktop ray-grid__cell--span-5-tablet ray-grid__cell--span-4-phone">
            <button class="kodin-hamburger ray-link">☰</button>
            <a href="/" class="kodin-brand-svg">
    <svg id="logo" height="35" width="700"></svg>
</a>

<script>
    function getRandomInt (max) {
        return Math.floor(Math.random() * max);
    }

    var kodinMe = "Kodin.me"
    var commands = [
        [`say "`, `Kodin"`],
        [`echo "`, `Kodin"`],
        [`PRINT "`, `Kodin"`],
        ['printf', `(`, `"Kodin"`, `);`],
        [`std`, `::`, `cout `, `<< `, `"Kodin"`, `;`],
        [`Console`, `.`, `WriteLine`, `(`, `"Kodin"`, `);`],
        [`print_endline `, `"Kodin"`, `;;`],
        [`(`, `println `, `"Kodin"`, `)`],
        [`DISPLAY `, `"Kodin"`],
        [`console`, `.`, `log `, `"Kodin"`],
        [`print`, `(`, `'Kodin'`, `);`],
        [`? `, `"Kodin"`],
        [`ShowMessage`, `(`, `'Kodin'`, `)`],
        [`print `, `(`, `"Kodin"`, `)`],
        [`io`, `:`, `fwrite`, `(`, `"Kodin"`, `).`],
        [`IO`, `.`, `puts `, `"Kodin"`],
        [`fmt`, `.`, `Println`, `(`, `"Kodin"`, `)`],
        [`println `, `"Kodin"`],
        [`putStrLn `, `"Kodin"`],
        [`System`, `.`, `out`, `.`, `println`, `(`, `"Kodin"`, `);`],
        [`console`, `.`, `log`, `(`, `'Kodin'`, `);`],
        [`(`, `print `, `"Kodin"`, `)`],
        [`PRINT `, `[`, `Kodin`, `]`],
        [`disp`, `(`, `Kodin`, `)`],
        [`puts`, `(`, `"Kodin"`, `)`],
        [`Write`, `(`, `'Kodin'`, `)`],
        [`<?`, `php `, `echo `, `"Kodin"`, `;`],
        [`Write`, `-`, `Host `, `"Kodin"`],
        [`cat`, `(`, `"Kodin"`, `)`],
        [`puts `, `'Kodin'`],
        [`println`, `!`, `(`, `"Kodin"`, `);`],
        [`println`, `(`, `"Kodin"`, `)`],
        [`'Kodin'`, ` `, `print`, `.`],
        [`show`, `: `, `'Kodin'`, `.`]
    ]

    SVG.on(document, 'DOMContentLoaded', function() {
        var commandParts = commands[getRandomInt(commands.length)];
        var command = commandParts.join('')

        var svg = SVG('logo');
        var text = svg.text('').move(0, -8);
        text.font({
            'font-family': 'Apercu',
            fill: '#000000',
            'font-size': 26,
            'font-weight': 600
        });

        var writeCommandObservable = Rx.Observable
            .interval(150)
            .take(command.length)

        var delayObservable = Rx.Observable
            .interval(1000)

        var deleteCommandObservable = Rx.Observable
            .concat(writeCommandObservable, delayObservable.take(1))
            .takeLast()
            .concatMap(() => Rx.Observable.interval(150))
            .take(commandParts.length)

        var writeLogoObservable = deleteCommandObservable
            .takeLast()
            .concatMap(() => Rx.Observable.interval(100))
            .take(kodinMe.length)

        writeCommandObservable.subscribe(i => {
            text.text(command.substr(0, i + 1))
        });

        deleteCommandObservable.subscribe(i => {
            var remainingOfCommand = commandParts.slice(0, commandParts.length - i - 1).join('')
            text.text(remainingOfCommand)
        })

        writeLogoObservable.subscribe(i => {
            text.text(kodinMe.substr(0, i + 1));
        });
    })
</script>

        </div>
        <div class="ray-grid__cell ray-grid__cell--span-3-desktop ray-grid__cell--span-3-tablet kodin-top-nav"><a class="ray-button ray-button--secondary ray-button--compact" href="/about/">About Me</a><a class="ray-button ray-button--secondary ray-button--compact" href="/posts/">All Posts</a></div>
    </div>
</header>
<main class="ray-page-container ray-page-container--justify-center">
    <div class="ray-grid"><div class="kodin-side-nav">
    <ul><li>
                    <a href="/about/">
                        About Me
                    </a>
                </li><li>
                    <a href="/posts/">
                        All Posts
                    </a>
                </li></ul>
</div>
<div class="ray-grid__cell ray-grid__cell--span-7-desktop ray-grid__cell--span-8-tablet ray-grid__cell--span-4-phone">
            
<article class="ray-running-text">
    <header class="kodin-post-header">
        <h1>
            
            ADT serialisation with Play JSON
            
        </h1>

        <div class="ray-grid">
            <div class="ray-grid__cell ray-grid__cell--span-6-desktop ray-grid__cell--span-4-tablet ray-grid__cell--span-4-phone">
                <time datetime="2019-08-24T11:00:00+02:00">
                    Aug 24, 2019
                </time>• <span>Dinko Osrecki</span></div>

            <div class="kodin-post-tags ray-grid__cell ray-grid__cell--span-6-desktop ray-grid__cell--span-4-tablet ray-grid__cell--span-4-phone"><span class="ray-tag">scala</span><span class="ray-tag">play</span><span class="ray-tag">json</span></div>
        </div>
    </header>

    <div>
        <p>Algebraic data type is a type formed by combining <strong>product</strong> types and <strong>sum</strong> types. Product type combines multiple
values of different types into one. It is called “tuple”, “record”, “struct”, “class”.  Sum type represents a value
that is either of one type or another. It is called “variant”, “enumeration”, “tagged union”.</p>

<p>In Scala, product type can be defined with <code class="highlighter-rouge">case class</code>, while sum type is represented by <code class="highlighter-rouge">sealed trait</code> and
<code class="highlighter-rouge">case object</code>s.</p>

<p>Product and sum types can also be combined to form hybrid ADTs. One such hybrid type is known as “Sum of Products”.
A very popular example of this type is a geometric shape. <code class="highlighter-rouge">Shape</code> is a sum type (together with its subclasses), while
<code class="highlighter-rouge">Rectangle</code>, <code class="highlighter-rouge">Ellipse</code> and <code class="highlighter-rouge">Polygon</code> are product types.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Shape</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Shape</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Ellipse</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Shape</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Polygon</span><span class="o">(</span><span class="n">points</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">)*)</span> <span class="k">extends</span> <span class="nc">Shape</span>
</code></pre></div></div>

<p>When serialised as JSON, these types would typically contain additional <code class="highlighter-rouge">type</code> field, also known as a tag. This field
is used to distinguish between the types which share exactly the same fields, e.g. <code class="highlighter-rouge">Rectangle</code> and <code class="highlighter-rouge">Ellipse</code>.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rectangle"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"x"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"y"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"width"</span><span class="p">:</span><span class="w"> </span><span class="mf">15.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"height"</span><span class="p">:</span><span class="w"> </span><span class="mf">10.0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ellipse"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"x"</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"y"</span><span class="p">:</span><span class="w"> </span><span class="mf">-4.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"width"</span><span class="p">:</span><span class="w"> </span><span class="mf">9.0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"height"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"polygon"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"points"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="mf">-3.0</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="mf">15.0</span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="mf">8.0</span><span class="p">,</span><span class="w"> </span><span class="mf">-4.8</span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>In <code class="highlighter-rouge">play-json</code>, it is fairly straightforward to (de)serialise each <code class="highlighter-rouge">Shape</code> by defining implicit <code class="highlighter-rouge">Reads</code> and <code class="highlighter-rouge">Writes</code>
instances for each <code class="highlighter-rouge">case class</code>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">play.api.libs.json._</span>

<span class="k">object</span> <span class="nc">Rectangle</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">tag</span> <span class="k">=</span> <span class="s">"rectangle"</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">reads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">writes</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Ellipse</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">tag</span> <span class="k">=</span> <span class="s">"ellipse"</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">reads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Ellipse</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Ellipse</span><span class="o">]</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">writes</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">Ellipse</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Ellipse</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Polygon</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">tag</span> <span class="k">=</span> <span class="s">"polygon"</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">reads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Polygon</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">reads</span><span class="o">[</span><span class="kt">Polygon</span><span class="o">]</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">writes</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">Polygon</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Json</span><span class="o">.</span><span class="py">writes</span><span class="o">[</span><span class="kt">Polygon</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This allows us to parse and stringify each subtype of <code class="highlighter-rouge">Shape</code> individually.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">play.api.libs.json.Json</span>

<span class="k">val</span> <span class="nv">json</span> <span class="k">=</span>
  <span class="s">"""
    | {
    |   "type": "rectangle",
    |   "x": 2.0,
    |   "y": 1.0,
    |   "width": 15.0,
    |   "height": 10.0
    | }
  """</span><span class="o">.</span><span class="py">stripMargin</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">parse</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]</span>

<span class="k">val</span> <span class="nv">rectangle</span> <span class="k">=</span> <span class="nc">Rectangle</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">rectangle</span><span class="o">)</span>
</code></pre></div></div>

<p>However, we still cannot serialise shapes in a more generic way. The following code will not compile.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">Json</span><span class="o">.</span><span class="py">parse</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">Shape</span><span class="o">]</span> <span class="c1">// No implicits found for parameter fjs: Reads[Shape]
</span>
<span class="k">val</span> <span class="nv">shape</span><span class="k">:</span> <span class="kt">Shape</span> <span class="o">=</span> <span class="nc">Rectangle</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">shape</span><span class="o">)</span> <span class="c1">// No implicits found for parameter tjs: Writes[Shape]
</span></code></pre></div></div>

<p>To read a <code class="highlighter-rouge">Shape</code> from JSON, we need to match on a <code class="highlighter-rouge">type</code> field, and based on its value use a reader from one of the
subclasses. In case that we meet an unknown type, we simply return an error. Since <code class="highlighter-rouge">Reads[A]</code> is invariant in type <code class="highlighter-rouge">A</code>,
we need to widen <code class="highlighter-rouge">Reads</code> of each subclass into <code class="highlighter-rouge">Reads[Shape]</code> with the help of <code class="highlighter-rouge">toShapeReads</code> implicit conversion.</p>

<p>To write a <code class="highlighter-rouge">Shape</code> into JSON, we simply match a value against its concrete type, and implicitly use the appropriate
writer.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">play.api.libs.json._</span>

<span class="k">object</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">reads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Shape</span><span class="o">]</span> <span class="k">=</span>
    <span class="o">(</span><span class="nc">__</span> <span class="o">\</span> <span class="s">"type"</span><span class="o">).</span><span class="py">read</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="py">flatMap</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nv">Rectangle</span><span class="o">.</span><span class="py">tag</span> <span class="k">=&gt;</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Reads</span><span class="o">[</span><span class="kt">Rectangle</span><span class="o">]]</span>
      <span class="k">case</span> <span class="nv">Ellipse</span><span class="o">.</span><span class="py">tag</span>   <span class="k">=&gt;</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Reads</span><span class="o">[</span><span class="kt">Ellipse</span><span class="o">]]</span>
      <span class="k">case</span> <span class="nv">Polygon</span><span class="o">.</span><span class="py">tag</span>   <span class="k">=&gt;</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">Reads</span><span class="o">[</span><span class="kt">Polygon</span><span class="o">]]</span>
      <span class="k">case</span> <span class="k">_</span>             <span class="k">=&gt;</span> <span class="nv">Reads</span><span class="o">.</span><span class="py">failed</span><span class="o">(</span><span class="s">"Invalid Shape"</span><span class="o">)</span>
    <span class="o">}</span>

  <span class="k">implicit</span> <span class="k">val</span> <span class="nv">writes</span><span class="k">:</span> <span class="kt">Writes</span><span class="o">[</span><span class="kt">Shape</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Writes</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">rectangle</span><span class="k">:</span> <span class="kt">Rectangle</span> <span class="o">=&gt;</span> <span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">rectangle</span><span class="o">)</span>
    <span class="k">case</span> <span class="n">ellipse</span><span class="k">:</span> <span class="kt">Ellipse</span>     <span class="o">=&gt;</span> <span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">ellipse</span><span class="o">)</span>
    <span class="k">case</span> <span class="n">polygon</span><span class="k">:</span> <span class="kt">Polygon</span>     <span class="o">=&gt;</span> <span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">polygon</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">implicit</span> <span class="k">def</span> <span class="nf">toShapeReads</span><span class="o">[</span><span class="kt">B</span> <span class="k">&lt;:</span> <span class="kt">Shape</span><span class="o">](</span><span class="n">reads</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reads</span><span class="o">[</span><span class="kt">Shape</span><span class="o">]</span> <span class="k">=</span> <span class="nv">reads</span><span class="o">.</span><span class="py">widen</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we can (de)serialise an array of <code class="highlighter-rouge">Shape</code>s.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">json</span> <span class="k">=</span>
  <span class="s">"""
    |[
    |  {
    |    "type": "rectangle",
    |    "x": 2.0,
    |    "y": 1.0,
    |    "width": 15.0,
    |    "height": 10.0
    |  },
    |  {
    |    "type": "ellipse",
    |    "x": 5.0,
    |    "y": -4.0,
    |    "width": 9.0,
    |    "height": 4.0
    |  },
    |  {
    |    "type": "polygon",
    |    "points": [
    |      [-3.0, 4.0],
    |      [4.5, 15.0],
    |      [8.0, -4.8]
    |    ]
    |  }
    |]
  """</span><span class="o">.</span><span class="py">stripMargin</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">parse</span><span class="o">(</span><span class="n">json</span><span class="o">).</span><span class="py">as</span><span class="o">[</span><span class="kt">Iterable</span><span class="o">[</span><span class="kt">Shape</span><span class="o">]]</span>

<span class="k">val</span> <span class="nv">shapes</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="nc">Rectangle</span><span class="o">(</span><span class="mf">2.0</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">),</span>
  <span class="nc">Ellipse</span><span class="o">(</span><span class="mf">5.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="o">,</span> <span class="mf">9.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">),</span>
  <span class="nc">Polygon</span><span class="o">((-</span><span class="mf">3.0</span><span class="o">,</span> <span class="mf">4.0</span><span class="o">),</span> <span class="o">(</span><span class="mf">4.5</span><span class="o">,</span> <span class="mf">15.0</span><span class="o">),</span> <span class="o">(</span><span class="mf">8.0</span><span class="o">,</span> <span class="o">-</span><span class="mf">4.8</span><span class="o">))</span>
<span class="o">)</span>
<span class="nv">Json</span><span class="o">.</span><span class="py">toJson</span><span class="o">(</span><span class="n">shapes</span><span class="o">)</span>
</code></pre></div></div>

    </div>
</article>



        </div>
    </div>
</main>

</body>

</html>
